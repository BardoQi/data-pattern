# 数据模式
## 第四章 结构类模式：树结构模式
 
树形结构的数据相当常见。比如，组织机构，系统菜单，会员推荐关系，产品的装配关系等等。
  
不用树形模式，会有很多悲剧。某开源电商，使用商品无限级分类，却只有parent_id，沿用MySQL官方网站上推荐的无限级分类联表查询，结果，分类到7层时，查询超过了7秒。比如某知名PDM的厂商，很多年前，要将一个产品加载并渲染出来时就耗时很久。
   
再例如，很多系统在选择部门时，一般一次性加载公司所有部门。曾有一个产品，卖绘一个大集团试机时，一选部门，立刻死机。为什么呢，因为这家集团有5000多个部门。
    
传统的树结构存储方式是采用左右链接的方法。但这种程序上的方便，又迫使树数据必须一次性加载。于是，这个厂商的老大深更半夜电话打到了我这里。我提供了树结构模式，于是，问题得以快速解决。
   
使用树结构模式的好处，可以按层去查，比较，一开始只加载第一层。后续可以一个节点一次展开一层，查询指定节点下的子节点，同时，一样也可以查出此节点下的所有分支。
   
程序中，我们可以使用树或者树与双向链表的复合数据结构来处理树型数据。但是在数据库里时，则是需求设计。
   
树结构，在数据表中必须添加的字段有：
   
* parent_id：存储父节点的id，顶层节点时，此值为0。
* level：记录此节点在第几层。
* path：记录此节点到顶层节点的路径。用逗号分隔，同时，路径中必须包括当前节点，并以逗号结束。比如，第一个节点的path就是“0,1,”。
* is_leaf：是否为叶节点。这不是必须的，但有些结构中少不了它，主要是程序的需要。此字段也用来方便树形界面组件进行加载。

这样做的好处即是，我们可以通过path排序，那结果就是真正符合树结构的节点顺序。
    
同时，如果利用当前节点的parh后面加上通配符，则可以查出所有的子节点。
    
假如，再加上用当前层的level加1为条件，则可以限定只查下一层子节点。
   
综上所述，树形结构模式，可以提升数据库使用效率，同时也可以大大简化程序开发。